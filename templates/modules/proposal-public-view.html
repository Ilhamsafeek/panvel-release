<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Proposal - PanvelIQ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@3.34.0/dist/tabler-icons.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #9926F3 0%, #1DD8FC 100%);
            --text-primary: #1a1a1a;
            --text-secondary: #555;
            --text-muted: #666;
            --border-color: #e0e0e0;
            --bg-light: #f8f9fa;
            --bg-gradient-light: linear-gradient(135deg, rgba(153,38,243,0.05) 0%, rgba(29,216,252,0.05) 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Gilroy', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        /* Header */
        .public-header {
            background: var(--primary-gradient);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            color: #fff;
        }
        
        .expiry-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            color: #fff;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        
        /* Loading & Error States */
        .loading-container, .error-container {
            text-align: center;
            padding: 80px 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border-color);
            border-top-color: #9926F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-icon i {
            font-size: 64px;
            color: #EF4444;
        }
        
        /* Proposal Container */
        .proposal-container {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
            display: none;
        }
        
        /* Proposal Header */
        .proposal-header {
            background: var(--primary-gradient);
            padding: 40px 30px;
            color: #fff;
            text-align: center;
        }
        
        .proposal-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .proposal-subtitle {
            font-size: 16px;
            opacity: 0.95;
            margin-bottom: 30px;
        }
        
        .proposal-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .meta-item {
            background: rgba(255,255,255,0.15);
            padding: 16px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        .meta-label {
            font-size: 12px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        
        .meta-value {
            font-size: 18px;
            font-weight: 600;
        }
        
        /* Sections */
        .proposal-section {
            padding: 40px 30px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .proposal-section:last-child {
            border-bottom: none;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .section-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 24px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .section-content {
            color: var(--text-secondary);
            line-height: 1.8;
        }
        
        .section-content h3 {
            color: var(--text-primary);
            font-size: 18px;
            margin: 24px 0 12px 0;
        }
        
        .section-content h3:first-child {
            margin-top: 0;
        }
        
        .section-content p {
            margin-bottom: 16px;
            color: var(--text-secondary);
        }
        
        .section-content ul {
            margin: 16px 0;
            padding-left: 24px;
        }
        
        .section-content li {
            margin-bottom: 8px;
            color: var(--text-secondary);
        }
        
        /* Campaign Cards */
        .campaign-card {
            background: var(--bg-gradient-light);
            border-left: 4px solid #9926F3;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        .campaign-card h4 {
            color: var(--text-primary);
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .campaign-card p {
            color: var(--text-secondary);
            font-size: 14px;
            margin: 6px 0;
        }
        
        .campaign-card strong {
            color: var(--text-primary);
        }
        
        /* Tool Grid */
        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .tool-item {
            background: #fff;
            border: 1px solid var(--border-color);
            padding: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .tool-icon {
            color: #9926F3;
            font-size: 24px;
        }
        
        .tool-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .tool-use {
            color: var(--text-secondary);
            font-size: 13px;
            margin-top: 4px;
        }
        
        /* Differentiator Grid */
        .differentiator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .differentiator-item {
            background: var(--bg-light);
            padding: 24px;
            border-radius: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .differentiator-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .differentiator-icon {
            width: 56px;
            height: 56px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 28px;
            margin-bottom: 16px;
        }
        
        .differentiator-text h4 {
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 8px;
        }
        
        .differentiator-text p {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
        }
        
        /* Value Proposition Cards */
        .value-prop-grid {
            display: grid;
            gap: 24px;
        }
        
        .value-prop-card {
            background: var(--bg-gradient-light);
            border-radius: 12px;
            padding: 24px;
            border-left: 4px solid #9926F3;
        }
        
        .value-prop-card h4 {
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .value-prop-card p {
            color: var(--text-secondary);
            margin-bottom: 12px;
        }
        
        .value-prop-card .impact {
            background: #fff;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
            border-left: 3px solid #10B981;
        }
        
        .value-prop-card .impact strong {
            color: #10B981;
        }
        
        /* ROI Section */
        .roi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }
        
        .roi-metric {
            background: var(--bg-gradient-light);
            padding: 24px;
            border-radius: 10px;
            text-align: center;
        }
        
        .roi-value {
            font-size: 32px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .roi-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        /* Timeline Grid */
        .timeline-grid {
            display: grid;
            gap: 16px;
        }
        
        .timeline-item {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #9926F3;
        }
        
        .timeline-phase {
            color: #9926F3;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .timeline-title {
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .timeline-description {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        /* Analysis Lists */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin: 24px 0;
        }
        
        .analysis-section {
            background: var(--bg-light);
            padding: 24px;
            border-radius: 10px;
        }
        
        .analysis-section h4 {
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .analysis-section ul {
            list-style: none;
            padding: 0;
        }
        
        .analysis-section li {
            padding: 12px;
            background: #fff;
            margin-bottom: 8px;
            border-radius: 6px;
            color: var(--text-secondary);
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        
        .analysis-section li i {
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .opportunities li i {
            color: #10B981;
        }
        
        .threats li i {
            color: #F59E0B;
        }
        
        /* Next Steps */
        .next-steps-list {
            counter-reset: step-counter;
            list-style: none;
            padding: 0;
        }
        
        .next-steps-list li {
            counter-increment: step-counter;
            padding: 16px;
            background: var(--bg-gradient-light);
            margin-bottom: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .next-steps-list li::before {
            content: counter(step-counter);
            background: var(--primary-gradient);
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        /* Footer */
        .proposal-footer {
            text-align: center;
            padding: 40px 20px;
            background: var(--bg-light);
            color: var(--text-muted);
        }
        
        .footer-cta {
            margin-top: 20px;
        }
        
        .btn-contact {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--primary-gradient);
            color: #fff;
            padding: 14px 32px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            font-size: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn-contact:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(153, 38, 243, 0.3);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .proposal-header {
                padding: 24px 20px;
            }
            
            .proposal-title {
                font-size: 24px;
            }
            
            .proposal-section {
                padding: 24px 20px;
            }
            
            .section-title {
                font-size: 20px;
            }
            
            .differentiator-grid,
            .tool-grid,
            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="public-header">
        <div class="header-content">
            <div class="logo">PanvelIQ</div>
            <div class="expiry-badge" id="expiryBadge">
                <i class="ti ti-clock"></i>
                <span id="expiryText">Loading...</span>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Loading State -->
        <div class="loading-container" id="loadingState">
            <div class="spinner"></div>
            <p style="color: var(--text-secondary);">Loading your proposal...</p>
        </div>
        
        <!-- Error State -->
        <div class="error-container" id="errorState" style="display: none;">
            <div class="error-icon">
                <i class="ti ti-alert-circle"></i>
            </div>
            <h2 style="color: var(--text-primary); margin: 16px 0;">Link Expired</h2>
            <p style="color: var(--text-secondary);">This proposal link has expired or is no longer valid.</p>
        </div>
        
        <!-- Proposal Content -->
        <div class="proposal-container" id="proposalContainer">
            <!-- Proposal Header -->
            <div class="proposal-header">
                <h1 class="proposal-title">Digital Marketing Proposal</h1>
                <p class="proposal-subtitle">for <span id="clientCompany">Your Business</span></p>
                <p style="font-size: 14px; opacity: 0.9;">Prepared by PanvelIQ</p>
                
                <div class="proposal-meta">
                    <div class="meta-item">
                        <div class="meta-label">Company</div>
                        <div class="meta-value" id="companyName">-</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Industry</div>
                        <div class="meta-value" id="businessType">-</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Budget</div>
                        <div class="meta-value" id="budget">-</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Created</div>
                        <div class="meta-value" id="createdDate">-</div>
                    </div>
                </div>
            </div>
            
            <!-- Executive Summary -->
            <div class="proposal-section" id="executiveSummarySection">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="ti ti-file-text"></i>
                    </div>
                    <h2 class="section-title">Executive Summary</h2>
                </div>
                <div class="section-content" id="executiveSummary">
                    <!-- Will be populated -->
                </div>
            </div>
            
            <!-- Challenges & Audience -->
            <div class="proposal-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="ti ti-target"></i>
                    </div>
                    <h2 class="section-title">Understanding Your Needs</h2>
                </div>
                <div class="section-content">
                    <h3>Current Challenges</h3>
                    <p id="challenges">-</p>
                    
                    <h3>Target Audience Analysis</h3>
                    <p id="targetAudience">-</p>
                </div>
            </div>
            
            <!-- AI Strategy -->
            <div class="proposal-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="ti ti-brain"></i>
                    </div>
                    <h2 class="section-title">Recommended Marketing Strategy</h2>
                </div>
                <div class="section-content" id="strategyContent">
                    <!-- Strategy content will be populated here -->
                </div>
            </div>
            
            <!-- Competitive Differentiators -->
            <div class="proposal-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="ti ti-trophy"></i>
                    </div>
                    <h2 class="section-title">Competitive Differentiators</h2>
                </div>
                <div class="section-content">
                    <p style="margin-bottom: 24px; color: var(--text-primary); font-weight: 500;">What sets our approach apart:</p>
                    <div id="competitiveDifferentiators">
                        <!-- Will be populated -->
                    </div>
                </div>
            </div>
            
            <!-- Unique Value Propositions -->
            <div class="proposal-section" id="valuePropsSection" style="display: none;">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="ti ti-star"></i>
                    </div>
                    <h2 class="section-title">Unique Value Propositions</h2>
                </div>
                <div class="section-content">
                    <div class="value-prop-grid" id="valuePropositions">
                        <!-- Will be populated -->
                    </div>
                </div>
            </div>
            
            <!-- Competitive Analysis -->
            <div class="proposal-section" id="competitiveAnalysisSection" style="display: none;">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="ti ti-chart-bar"></i>
                    </div>
                    <h2 class="section-title">Competitive Analysis</h2>
                </div>
                <div class="section-content">
                    <div class="analysis-grid" id="competitiveAnalysis">
                        <!-- Will be populated -->
                    </div>
                </div>
            </div>
            
            <!-- ROI Simulation -->
            <div class="proposal-section" id="roiSection" style="display: none;">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="ti ti-trending-up"></i>
                    </div>
                    <h2 class="section-title">ROI Simulation</h2>
                </div>
                <div class="section-content">
                    <p id="roiIntro" style="margin-bottom: 24px; color: var(--text-primary); font-weight: 500;"></p>
                    <div class="roi-grid" id="roiMetrics">
                        <!-- Will be populated -->
                    </div>
                </div>
            </div>
            
            <!-- Timeline -->
            <div class="proposal-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="ti ti-calendar"></i>
                    </div>
                    <h2 class="section-title">Project Timeline</h2>
                </div>
                <div class="section-content">
                    <div class="timeline-grid" id="timelineGrid">
                        <!-- Timeline will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Next Steps -->
            <div class="proposal-section" id="nextStepsSection" style="display: none;">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="ti ti-checklist"></i>
                    </div>
                    <h2 class="section-title">Next Steps</h2>
                </div>
                <div class="section-content">
                    <ul class="next-steps-list" id="nextSteps">
                        <!-- Will be populated -->
                    </ul>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="proposal-footer">
                <p style="font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">We look forward to partnering with you to achieve exceptional marketing results!</p>
                <p>Prepared by <strong>PanvelIQ Team</strong></p>
                <p style="margin-top: 4px;">AI-Powered Digital Marketing Intelligence</p>
                <div class="footer-cta">
                    <a href="mailto:info@panveliq.com" class="btn-contact">
                        <i class="ti ti-mail"></i>
                        Get in Touch
                    </a>
                </div>
                <p style="margin-top: 20px; font-size: 13px;">Contact: info@panveliq.com | www.panveliq.com</p>
            </div>
        </div>
    </main>
    
    <script>
        // Get share token from URL
        const pathParts = window.location.pathname.split('/');
        const shareToken = pathParts[pathParts.length - 1];
        
        // API Base URL
        const API_BASE = '/api/v1';
        
        // Load proposal on page load
        document.addEventListener('DOMContentLoaded', loadProposal);
        
        async function loadProposal() {
            try {
                const response = await fetch(`${API_BASE}/project-planner/proposals/shared/${shareToken}`);
                const result = await response.json();
                
                if (!response.ok) {
                    showError(
                        response.status === 410 ? 'Link Expired' : 'Invalid Link',
                        result.detail || 'This proposal link is no longer valid.'
                    );
                    return;
                }
                
                if (result.success) {
                    displayProposal(result.proposal, result.link_info);
                } else {
                    showError('Error', result.message || 'Failed to load proposal');
                }
            } catch (error) {
                console.error('Error loading proposal:', error);
                showError('Connection Error', 'Unable to load the proposal. Please try again later.');
            }
        }
        
        function showError(title, message) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('proposalContainer').style.display = 'none';
            document.getElementById('errorState').style.display = 'flex';
        }
        
        function displayProposal(proposal, linkInfo) {
            // Hide loading, show proposal
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('proposalContainer').style.display = 'block';
            
            // Update expiry badge
            if (linkInfo && linkInfo.days_remaining !== undefined) {
                const expiryText = linkInfo.days_remaining > 0 
                    ? `Expires in ${linkInfo.days_remaining} day${linkInfo.days_remaining !== 1 ? 's' : ''}`
                    : 'Expires today';
                document.getElementById('expiryText').textContent = expiryText;
            }
            
            // Populate header info
            const companyName = proposal.company_name || 'Your Business';
            document.getElementById('clientCompany').textContent = companyName;
            document.getElementById('companyName').textContent = companyName;
            document.getElementById('businessType').textContent = proposal.business_type || '-';
            document.getElementById('budget').textContent = proposal.budget 
                ? `â‚¹${Number(proposal.budget).toLocaleString()}` 
                : '-';
            document.getElementById('createdDate').textContent = proposal.created_at 
                ? new Date(proposal.created_at).toLocaleDateString('en-US', { 
                    year: 'numeric', month: 'long', day: 'numeric' 
                }) 
                : '-';
            
            // Executive Summary
            populateExecutiveSummary(proposal);
            
            // Populate challenges and audience
            document.getElementById('challenges').textContent = proposal.challenges || 'No specific challenges mentioned.';
            document.getElementById('targetAudience').textContent = proposal.target_audience || 'Target audience not specified.';
            
            // Populate strategy
            populateStrategy(proposal.ai_generated_strategy);
            
            // Populate competitive differentiators
            populateCompetitiveDifferentiators(proposal.competitive_differentiators);
            
            // Populate value propositions (if present)
            populateValuePropositions(proposal.value_propositions);
            
            // Populate competitive analysis (if present)
            populateCompetitiveAnalysis(proposal.competitive_analysis);
            
            // Populate ROI simulation (if present)
            populateROISimulation(proposal.roi_simulation, proposal.budget);
            
            // Populate timeline
            populateTimeline(proposal.suggested_timeline);
            
            // Populate next steps (if present)
            populateNextSteps(proposal.next_steps);
        }
        
        function populateExecutiveSummary(proposal) {
            const container = document.getElementById('executiveSummary');
            const companyName = proposal.company_name || 'your business';
            const businessType = proposal.business_type || 'business';
            const budget = proposal.budget ? `â‚¹${Number(proposal.budget).toLocaleString()}` : 'your investment budget';
            
            container.innerHTML = `
                <p>This comprehensive digital marketing proposal has been specifically designed for <strong>${companyName}</strong>, a <strong>${businessType}</strong> looking to enhance their digital presence and drive measurable growth.</p>
                <p>Our AI-powered approach combines cutting-edge marketing technology with proven strategies to deliver exceptional results within your investment budget of <strong>${budget}</strong>.</p>
            `;
        }
        
        function populateStrategy(strategy) {
            const container = document.getElementById('strategyContent');
            
            if (!strategy || (typeof strategy === 'object' && Object.keys(strategy).length === 0)) {
                container.innerHTML = '<p>Strategy details will be provided upon further consultation.</p>';
                return;
            }
            
            let html = '<p style="margin-bottom: 24px;">Based on our AI analysis, we recommend a comprehensive marketing approach across multiple channels.</p>';
            
            // Recommended Campaigns Section
            if (strategy.Recommended_Campaigns && Array.isArray(strategy.Recommended_Campaigns)) {
                html += '<h3>Recommended Campaigns</h3>';
                
                strategy.Recommended_Campaigns.forEach(campaign => {
                    html += `
                        <div class="campaign-card">
                            <h4>Campaign (${campaign.Platform || 'Platform'}):</h4>
                            ${campaign.Content_Topics ? `<p><strong>Content Topics:</strong> ${campaign.Content_Topics}</p>` : ''}
                            ${campaign.Creative_Format ? `<p><strong>Creative Format:</strong> ${campaign.Creative_Format}</p>` : ''}
                        </div>
                    `;
                });
            }
            
            // Automation Tools Section
            if (strategy.Automation_Tools && Array.isArray(strategy.Automation_Tools)) {
                html += '<h3 style="margin-top: 32px;">Automation Tools & Technologies</h3>';
                html += '<div class="tool-grid">';
                
                strategy.Automation_Tools.forEach(tool => {
                    html += `
                        <div class="tool-item">
                            <i class="ti ti-tool tool-icon"></i>
                            <div>
                                <div class="tool-name">${tool.Tool || 'Tool'}</div>
                                <div class="tool-use">${tool.Use || 'Campaign enhancement'}</div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        function populateCompetitiveDifferentiators(differentiators) {
            const container = document.getElementById('competitiveDifferentiators');
            
            const defaultDiffs = [
                {
                    title: 'Faster Deployment with Automation',
                    description: 'Our agency leverages cutting-edge automation tools to expedite the deployment of your marketing campaigns. This allows us to launch your campaigns faster and more efficiently.',
                    impact: 'This will save your business time and resources, allowing you to focus on what matters most - growing your business.'
                },
                {
                    title: 'AI-Personalized Targeting',
                    description: 'We use advanced AI technologies to personalize your marketing messages and target your ideal customers with precision.',
                    impact: 'This will increase your engagement rates, conversion rates, and overall ROI on your marketing investment.'
                },
                {
                    title: 'Cost-Efficiency',
                    description: 'Our digital marketing strategy is designed to maximize your budget. We focus on the most effective channels and tactics to ensure you get the most out of every dollar spent.',
                    impact: 'This will reduce your marketing spend while still achieving your desired results.'
                },
                {
                    title: 'Advanced Performance Tracking',
                    description: 'We provide comprehensive and real-time tracking of your marketing performance. Our advanced analytics will give you deep insights into your campaign\'s success.',
                    impact: 'This will allow you to make data-driven decisions and continuously optimize your marketing strategy.'
                }
            ];
            
            let items = defaultDiffs;
            
            if (differentiators && Array.isArray(differentiators) && differentiators.length > 0) {
                items = differentiators;
            }
            
            let html = '';
            items.forEach(diff => {
                html += `
                    <div class="value-prop-card">
                        <h4><strong>${diff.title}</strong></h4>
                        <p>${diff.description}</p>
                        ${diff.impact ? `
                            <div class="impact">
                                <strong>Impact:</strong> ${diff.impact}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function populateValuePropositions(valueProps) {
            if (!valueProps || !Array.isArray(valueProps) || valueProps.length === 0) return;
            
            document.getElementById('valuePropsSection').style.display = 'block';
            const container = document.getElementById('valuePropositions');
            
            let html = '';
            valueProps.forEach(prop => {
                html += `
                    <div class="value-prop-card">
                        <h4>${prop.icon || 'ðŸš€'} ${prop.title}</h4>
                        <p>${prop.description}</p>
                        ${prop.competitive_advantage ? `
                            <p><strong>Competitive Advantage:</strong> ${prop.competitive_advantage}</p>
                        ` : ''}
                        ${prop.impact ? `
                            <div class="impact">
                                <strong>Impact:</strong> ${prop.impact}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function populateCompetitiveAnalysis(analysis) {
            if (!analysis || !analysis.opportunities || !analysis.threats) return;
            
            document.getElementById('competitiveAnalysisSection').style.display = 'block';
            const container = document.getElementById('competitiveAnalysis');
            
            let html = `
                <div class="analysis-section opportunities">
                    <h4><i class="ti ti-circle-check" style="color: #10B981;"></i> Opportunities</h4>
                    <ul>
            `;
            
            analysis.opportunities.forEach(opp => {
                html += `<li><i class="ti ti-check"></i> ${opp}</li>`;
            });
            
            html += `
                    </ul>
                </div>
                <div class="analysis-section threats">
                    <h4><i class="ti ti-alert-triangle" style="color: #F59E0B;"></i> Threats</h4>
                    <ul>
            `;
            
            analysis.threats.forEach(threat => {
                html += `<li><i class="ti ti-alert-circle"></i> ${threat}</li>`;
            });
            
            html += `
                    </ul>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function populateROISimulation(roi, budget) {
            if (!roi || !roi.expected_leads) return;
            
            document.getElementById('roiSection').style.display = 'block';
            
            const budgetFormatted = budget ? `â‚¹${Number(budget).toLocaleString()}` : 'â‚¹4,500';
            document.getElementById('roiIntro').textContent = `If you spend ${budgetFormatted}, expect...`;
            
            const container = document.getElementById('roiMetrics');
            
            let html = `
                <div class="roi-metric">
                    <div class="roi-value">${roi.expected_leads || 0}</div>
                    <div class="roi-label">Expected Leads</div>
                </div>
                <div class="roi-metric">
                    <div class="roi-value">â‚¹${roi.avg_cost_per_lead || '3.13'}</div>
                    <div class="roi-label">Avg Cost Per Lead</div>
                </div>
                <div class="roi-metric">
                    <div class="roi-value">${roi.conversion_rate || '5'}%</div>
                    <div class="roi-label">Conversion Rate</div>
                </div>
                <div class="roi-metric">
                    <div class="roi-value">â‚¹${roi.estimated_revenue ? Number(roi.estimated_revenue).toLocaleString() : '14,400'}</div>
                    <div class="roi-label">Estimated Revenue</div>
                </div>
            `;
            
            if (roi.expected_customers) {
                html += `
                    <div class="roi-metric">
                        <div class="roi-value">${roi.expected_customers}</div>
                        <div class="roi-label">Expected Customers</div>
                    </div>
                `;
            }
            
            if (roi.roi_year_1) {
                html += `
                    <div class="roi-metric">
                        <div class="roi-value">${roi.roi_year_1}%</div>
                        <div class="roi-label">ROI by Year 1</div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function populateTimeline(timeline) {
            const container = document.getElementById('timelineGrid');
            
            const defaultTimeline = [
                { phase: 'Phase 1', title: 'Planning & Setup', desc: 'Initial strategy development', duration: '2-4 weeks' },
                { phase: 'Phase 2', title: 'Implementation', desc: 'Campaign setup and launch', duration: '2-3 weeks' },
                { phase: 'Phase 3', title: 'Optimization', desc: 'Performance monitoring and optimization', duration: 'Ongoing' },
                { phase: 'Phase 4', title: 'Reporting', desc: 'Results analysis and reporting', duration: 'Monthly' }
            ];
            
            let items = defaultTimeline;
            
            if (timeline && Array.isArray(timeline) && timeline.length > 0) {
                items = timeline;
            } else if (timeline && timeline.phases && Array.isArray(timeline.phases)) {
                items = timeline.phases;
            }
            
            container.innerHTML = items.map(item => `
                <div class="timeline-item">
                    <div class="timeline-phase">${item.phase}${item.duration ? ' â€¢ ' + item.duration : ''}</div>
                    <div class="timeline-title">${item.title}</div>
                    <div class="timeline-description">${item.desc || item.description || ''}</div>
                </div>
            `).join('');
        }
        
        function populateNextSteps(steps) {
            if (!steps || !Array.isArray(steps) || steps.length === 0) {
                // Use default next steps
                steps = [
                    'Review this proposal and provide feedback',
                    'Schedule a strategy session to discuss implementation',
                    'Finalize project scope and timeline',
                    'Begin Phase 1 execution'
                ];
            }
            
            document.getElementById('nextStepsSection').style.display = 'block';
            const container = document.getElementById('nextSteps');
            
            container.innerHTML = steps.map(step => {
                const text = typeof step === 'string' ? step : (step.text || step.description || '');
                return `<li>${text}</li>`;
            }).join('');
        }
    </script>
</body>
</html>